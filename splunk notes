More than 90% data are stored as machine data, but they are not always structured.

splunk: input, parsing, indexing, searching

é”™è¯¯çš„ï¼š In most splunk deployments, [forwarders] serve as the primary way data is supplied for indexing

Search data are processed by [indexers]

Search strings are sent from the [search heads]

[forwarders] serve as the primary way data is supplied for indexing
cd /Applications/splunk/bin

./splunk start or stop or restart or help


Splunk Cloud

admin role install & create knowledge objects for users of the app and do realtime searches
power role create and share knowledge objects for users of the app and do realtime searches
user role 


U can launch and manage apps from the home app

upload(for data created once and never modified)
 å®žé™…ä¸ç”¨ ä½†æ˜¯å¾ˆé€‚åˆtest or small dataset
monitor 
forward(ä»Žå¤–ç•Œçš„æ•°æ®æ¥) -> index data

host file value - instance name

module 4
index: most data are stored
ä½†ä¸åº”è¯¥å…¨éƒ¨å­˜åœ¨main index ä½†è¿™ä¸åº”è¯¥
1. åˆ†å¼€æœç´¢æ•ˆçŽ‡æé«˜
2. å¯ä»¥æ–¹ä¾¿è®¾ç½®æƒé™ by user role
3. ä¸åŒindexçš„ä¿å­˜æ—¶é—´å¯ä»¥è®¾ç½®çš„ä¸åŒ
web data index
security index

monitor
files and directions: access.log  ç‚¹å‡»startå°±ä¼šå¼€å§‹indexing 

forwardersä¹‹åŽå¼„

quiz: The monitor input option will allow u to continuously monitor files â˜‘ï¸

Splunk uses ã€source typesã€‘ï¼ˆå¡«ç©ºé¢˜ï¼‰ to categorize the type of data being indexed. Further Explanation: The source type is the default field for splunk software that assigns to all incoming data. The purpose of source type in splunk software is format the data in indexing, categorise your data for easy searching

In most production environments, ã€forwardersã€‘ will be used as the source of data input.



module 5
ä¸€ä¸ªsearch jobä¼šæŒç»­10åˆ†é’Ÿ ç„¶åŽé‡æ–°search
ä¸€ä¸ªshared search job ä¼šæŒç»­7å¤©readable

not or and
é»˜è®¤and  \" å³å¯è¾“å…¥å¼•å·

quizï¼š The time stamp u c in the events is based on the time zone set inh your own account
Commands that create statistics and visualizations are called ã€transformingã€‘ commands
æ“ä½œä¼˜å…ˆçº§ NOT > OR > AND

è¿”å›žçš„events å¹¶ä¸æ˜¯æ°¸è¿œæŒ‰ç…§æ—¶é—´é¡ºåºæŽ’åºçš„

module 6
a - string
# - number 

=! = å…¨éƒ¨ç±»åž‹
> < ä¹‹ç±»çš„æ™ºèƒ½numerical 

ä¸»è¦æ³¨æ„ (index=web OR index=security) status!=200      2310 events
        (index=web OR index=security) NOT status=200    21955 events
        æ²¡å¤ªçœ‹æ‡‚æ„æ€ å¤§æ¦‚æ˜¯è¯´ä¸‹é¢çš„åŒæ—¶åŒ…æ‹¬äº†type&numberä¸ç›¸ç­‰çš„ï¼Ÿ

Wildcards cannot be used with field searches.
æ¯”å¦‚å¯ä»¥status="fail*" ä½†ä¸å¯ä»¥product* = â€œSCBFâ€

module 7 
index source host sourcetypeæ˜¯åœ¨indexçŽ¯èŠ‚å°±å·²ç»ç¼–å¥½å·çš„ æ¯æ¬¡searchä¸ç”¨é‡æ–°å¼„äº†

inclusive > exclusive e.g. access denied ä¼šæ¯”æœç´¢ not access granted å¿«

-30s -30m -30h -30d -30mon -30y
earlist=01/08/2018 latest=

index for web data / security dta

quizï¼š
deperate indexes allows: ability to limit access + multiple retentionï¼ˆ=reservation æ•°æ®ä¿ç•™æ”¿ç­–ï¼‰ policies + faster searches
@ is the symbol used in "Advanced" section of the time range picker to round down to nearest unit of specified time

module 8 
search terms: sourcetype=acc*
commands: stats
functions(arguments):list(product_name)
clauses: as 

sourcetype=acc* | states list(product_name) as "game_window"
shift + å›žè½¦ è‡ªåŠ¨æ¢è¡Œ

username - preferences å¯ä»¥è‡ªåŠ¨é€‰æ‹©search theme è‡ªåŠ¨è¡¥å…¨etc

search | commands

fields command:
fields status clientip
fields - status clientip åŽ»æŽ‰éƒ¨åˆ† 
field extraction is one of the most costly parts of searching in splunk
file inclusion happens before field extraction and can improve performance
field exclusion happens after field extration. å°±åªå½±å“ç»“æžœ å¯¹performanceæ²¡å•¥å½±å“

table & rename command:
|table JSESSIONID, product_name, price. è‡ªåŠ¨ç”ŸæˆæŒ‰ç…§è¯¥é¡ºåºçš„è¡¨å“¥
|rename JSESSIONID as "User Session"
product_name as "Purchased Game"    price as "Purchase Price" //as åŽå¯ä¸åŠ å¼•å· åŠ äº†å¼•å·ä¹Ÿä¼šç›´æŽ¥åŒ…å«å¼•å·
| fields - "User Session" // è¿™é‡Œéœ€è¦ç”¨"User Session"è€ŒéžJSESSIONID è€Œä¸”å¿…é¡»è¦åŠ å¼•å·
éœ€è¦æ³¨æ„å·²ç»renameåŽ åŽé¢çš„pipelineséœ€è¦ç”¨é‡å‘½ååŽçš„username

dedup command: å‡å°‘duplicate
index=security sourcetype=history* Address_Description="San Francisco"
| dedup Username // æˆ– dedup First_Name Last_Name è¿™æ ·å°±å¯ä»¥æŠŠå¤šæ¬¡è¿›å…¥å¤§æ¥¼çš„å‘˜å·¥åfilteræŽ‰åªæ˜¾ç¤ºä¸€æ¬¡
| table Username First_Name Last_Name 


sort commanbd:
sourcetype=vendor_sales 
| table Vendor product_name  sale_price
| sort - sale_price Vendor //- & fieldnameé—´æœ‰ç©ºæ ¼è¿™æ · å°±å…¨éƒ¨é™åº
| sort -sale_price Vendor  //- & fieldnameé—´æ²¡ç©ºæ ¼è¿™æ · å°±sale_priceé™åº Vendorç…§æ ·å‡åº

Lab-æ­£ç¡®ans:
index=main sourcetype=access_combined_wcookie action=purchase status=200 file=success.do//æˆ‘ä¸€å¼€å§‹å¿˜è®°åŠ äº†index sourcetype è¿™ä¿©fieldname è€ƒè™‘ä¸å…¨é¢å§ 
| dedup JSESSIONID     //æˆ‘WAäº† ä¸€å¼€å§‹dedupåŠ åˆ°æ‰€æœ‰pipeçš„æœ€åŽ å·²ç»ä¸èƒ½dedupäº†
| table JSESSIONID      //åœ¨åªéœ€è¦JESSIONIDçš„æ—¶å€™ æˆ‘ä¸€å¼€å§‹ä¾ç„¶åŠ äº†field JSESSIONID action status å°±å¾ˆå¤šä½™
| rename JSESSIONID as UserSessions

Mod9 - transfer to visulize
top command(finds the most common values of a given field)
index=sales sourcetype=vendor_sales
| top Vendor limit=20 
top command clausesï¼š (é»˜è®¤æ˜¾ç¤ºtop10)
    limit = int
    percentfield/countfield/otherstr = string
    showcount/showperc/showother = True/False

index=sales sourcetype=vendor_sales
|top product_name by Vendor limit=3 countfield="Number of Sales" showperc=False

rare command(same as top ä½†æ˜¾ç¤ºæœ€å°‘çš„)
stats command
    -count, distinct_count:
        index=sales sourcetype=vendor_sales
        | stats count as "Total Sells By Vendors" by product_name, categoryID

        //count(field)ç”¨æ³•ï¼š
        index=web sourcetype=access_combined
        | stats count(action) as ActionEvents, count as "Total Events"// è¿™æ ·å°±åªæœ‰åŒ…å«actionçš„eventsä¼šè¢«count


    - sum:
        index=sales sourcetype=vendor_sales
        |stats count as "Units Sold" 
        stats sum(price) as "Gross Sales" by product_name

    - average, min, max:
        index=sales sourcetype=vendor_sales
        | stats avg(sale_price) as "Average Price"
            min(sale_price) as "Min Price"
            max(sale_price) as "Max Price" by categoryID

    - list(æ˜¾ç¤ºæ‰€æœ‰values):
        index=bcgassets sourcetype=asset_list
        |stats list(Asset) as "company assets" by Employee

    - values(æ˜¾ç¤ºunique values):
        index=network sourcetype=cisco_wsa_squid
        | stats values(s_hostname) by cs_username //å°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªå‘˜å·¥ä¸Šç­æµè§ˆäº†å“ªäº›ç½‘ç«™

Lab:
index=main sourcetype="access_combined_wcookie" file=success.do OR file=cart.do status=200  
//æˆ‘ä¸€å¼€å§‹å¿˜è®°åŠ status=200 ç„¶åŽåœ¨file=success.do OR file=cart.doä¸¤ä¾§åŠ äº†æ‹¬å· å…¶å®žä¸ç”¨çš„ å› ä¸ºNOT>OR>AND



mod10

index=web sourcetype=access_combined status=200 action=purchase 
| timechart count as "Units Sold" by product_name usenull=f useother=f
Format - Legend - Left
dashboard å°±æ˜¯ä¸€å †reportä¸€èµ· æ›´å¥½çœ‹  ç¬¬äºŒæ¬¡æ·»åŠ searchç»“æžœ å°±å¯ä»¥æ·»åŠ åˆ°existing dashboardé‡Œçš„paneläº†

ä¹Ÿå¯ä»¥add input(e.g. time range)
ä½†éœ€è¦æ³¨æ„ the time range picker will only work on panels with an inline search

å¯ä»¥ç‚¹å‡»search clone to inline search

lab:
index=main sourcetype="access_combined_wcookie" status=403 
| stats count as attempts by clientip

æ³¨æ„ç›´æŽ¥æŒ‰ç…§clientipç‚¹countsçš„è¯ ç›´æŽ¥count by clientipå³å¯ 
è€Œä¸æ˜¯countï¼ˆclientipï¼‰ é‚£æ˜¯ç‚¹æ€»å…±clientipæœ‰å‡ ä¸ªäº†

æˆ‘åˆè‡ªå·±åŠ äº†ä¸€ä¸ªtop_purchase_productID
index=main sourcetype="access_combined_wcookie" file=success.do status=200 
| top productId showperc=false

quiz:
WAçš„ åªæœ‰æä¾›äº† statistic values æ‰èƒ½view it as a chart

mod11 pivot and datasets

data models: knowledge objects that provide the data structure that drives pivots
pivot interface to dataset

settings - data models - pivot 

split rows - category
filters - is not å°±ç›¸å½“äºŽ - ***

pivot

statistics - pivot - fiel


Datasets summerize fields
    explore - visulize Splunk Datasets plug on 

quiz: åªæœ‰admin/powerå¯ä»¥create data models useræ˜¯ä¸å¯ä»¥çš„å“¦(æ­¤å¤„WAäº†ï¼‰

The instant pivot button is displayed in the statistics and visualizations when a (non-transforming) ï¼ˆæ­¤å¤„WAäº†ï¼‰ search is run.

module 12 lookups
how to set up a lookup file? 
    - define a lookup table (æ¯”å¦‚code200 å¯¹åº”description-suceess)
        Settings - search - define... choosefile 
        å¯ä»¥change æŸ¥çœ‹çš„ permissions
        check by | inputlookup http_status.csv
    - define the lookup
        Settings - search - lookup tables 
        http_status  + File-based + http_status.csv 
            å¯ä»¥é€‰æ‹©default matchesæ˜¯å¦case sentive
            ä¹Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦time-based

lookup commands:
index=web sourcetype=access_combined NOT status=200
| lookup http_status code as status,
OURPUT code as "HTTP Code", description as "HTTP Description" è¿™æ ·åœ¨fields é‡Œå¤´çš„ åå­—ä¹Ÿå°±å˜äº†
ä½†æ³¨æ„lookupçš„asä¼šæœ‰è¦†ç›–æ€§ å¦‚æžœä¸æƒ³è¦†ç›–existing fieldsè¯å¯ä»¥ï¼š
index=web sourcetype=access_combined NOT status=200
| lookup http_status code as status,
OURPUTNEW code as "HTTP Code", description as "HTTP Description"
ä¹Ÿå¯ä»¥å†åŠ  | table host, "HTTP Code", "HTTP Description" è¿™æ ·æ›´æ¸…æ¥š

automatic lookupsï¼š

destination: search 
name: https_status_lookup
lookup table: http_status_lookup
named: access_combined
lookup input fields code = status
    code="Code"
    description="Description"

è¿™æ ·å­åœ¨searchçš„æ—¶å€™ ç›´æŽ¥ index=web sourcetype=access_combined NOT status=200
|table hostï¼Œ "Code"ï¼Œ "Description"
è¿™æ ·å°±ä¸ç”¨åƒä¸Šé¢é‚£æ · as as asäº†

additional lookup options:
populate lookup table with search results
define lookup based on external script or command.
use splunk dp connect application
use geospatial lookups to create queries that can be used to generate choropleth map visualizations
populate events with KV Store fields

lab:
æˆ‘åšçš„æ—¶å€™ä¸€å¼€å§‹ä¸€ç›´æŠ¥é”™ è¯´ inputlookup has to be the first command
åŽæ¥æ‰çŸ¥é“ä¸è¦å†™index=main etc ç›´æŽ¥ searchå¸¦|çš„ â€œ| inputlookup products_lookupâ€ å³å¯ 


index=main sourcetype="access_combined_wcookie" action=purchase file=success.do status=200
 | lookup products_lookup productId as productId, OUTPUT product_name as ProductName 
| stats count by ProductName
æ‰çŸ¥é“æ˜¯ lookup "tablename" "ori" as "dest" è¿™æ ·çš„æ ¼å¼

automatic lookup ä¸­æŠŠprice=Price product_name=ProductName åŽ  ðŸ”æ—¶åªéœ€è¦â¬‡ï¸å³å¯
index=main sourcetype="access_combined_wcookie"  status=200  file=success.do
| stats sum("Price") as Revenue by "ProductName" //æ³¨æ„è¿™é‡Œ"Price" "ProductName" çš„å¼•å·ä¹Ÿå¯ä»¥ä¸åŠ çš„
| sort -Revenue  


quiz:
A lookup is categorized as a dataset. True

module13 Scheduled Reports and Alerts

åŒæ ·çš„search - save as reports - time range picker é‚£é‡Œé€‰æ‹©no

schedule - schedule report 
ä¸ºäº†åˆç†åˆ†é…ç¡¬ä»¶èµ„æº å¯ä»¥è®¾ç½®schedule priority ä½†åªæœ‰adminèƒ½è®¾ç½® 
ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªschedule window (e.g. 15min çš„å«ä¹‰æ˜¯ åªè¦åœ¨è®¾ç½®æ—¶é—´çš„15minå†…run å‡å¯)

Tip: Include a schedule window only if the report doesn't have to start at a specific time and u are ok with the delay.  ä¹Ÿå¯ä»¥ç›´æŽ¥è®¾ç½®æˆauto

Manage Scheduled Reports:
    settings: search&report
    æˆ–è€…ç›´æŽ¥ç‚¹å‡»reports

    Edit - Embedè¿›html: [è°¨æ…Ž] anyone with access to the webpage will be able to see the report. 
    tipï¼š An embedded report will not show data until the scheduled search is run
        å½“ç„¶ä¸€æ—¦embedäº† é‚£äº›å‚æ•°ä¹Ÿå°±ä¸èƒ½ä¿®æ”¹å•¦

    ä¹Ÿå¯ä»¥edit - add to dashboard

alerts:
index=web sourcetype=access_combined status=5* 
save as alert 
    realtime alerts vs scheduled alerts å‰è€…å› ä¸ºä¸€ç›´è·‘ å¯¹ç³»ç»Ÿè´Ÿæ‹…æ›´å¤§
Tip: we would like to confirm a problem before sending an alert æ¯”å¦‚è®¤ä¸º1minå†…>1æ¬¡ 

final quiz:
[smart] seach mode toggles(æ‹¨åŠ¨) behavior based on he type of search being run. 
Data models are made up of [Datasets]
adding child data model objects is like the [AND] boolean in the splunk search language